# 상담 관리 시스템 설계 요약

## 핵심 개념 한눈에 보기

### 1. 상담 처리 흐름

```
┌──────────┐
│고객 문의  │
└────┬─────┘
     ↓
┌──────────────────────────────────────────────────┐
│ 1단계: 상담 등록                                  │
│  - 상담사가 고객 정보와 문의 내용 입력             │
│  - 시스템이 자동으로 우선순위 및 SLA 기한 계산     │
│  - 상담사에게 자동 할당                           │
└────┬─────────────────────────────────────────────┘
     ↓
┌──────────────────────────────────────────────────┐
│ 2단계: 상담 처리                                  │
│  - 상담사가 문의 내용 확인 및 처리                 │
│                                                   │
│  [분기점]                                         │
│  A. 처리 가능 → 해결 완료                         │
│  B. 처리 어려움 → 이관 또는 에스컬레이션            │
└────┬─────────────────────────────────────────────┘
     ↓
     ├─→ [A. 정상 처리] → 완료 → 종료
     │
     └─→ [B. 처리 어려움]
          ↓
     ┌────────────────────────────────┐
     │ 옵션 1: 이관 (Transfer)         │
     │  - 다른 상담사에게 넘김          │
     │  - 최대 3회까지 가능             │
     │  - 3회 초과 시 자동 에스컬레이션  │
     └───┬────────────────────────────┘
         │
     ┌───┴────────────────────────────┐
     │ 옵션 2: 에스컬레이션 (Escalation)│
     │  - 관리자에게 상위 보고          │
     │  - 우선순위 자동 상향            │
     │  - 더 높은 권한으로 처리          │
     └───┬────────────────────────────┘
         ↓
     [관리자 처리] → 해결 → 완료 → 종료
```

---

## 2. 이관 (Transfer) 개념

### 언제 이관하나?

- **업무 분산**: 한 상담사에게 업무가 몰릴 때
- **전문가 필요**: 특정 분야 전문가가 필요할 때 (예: 기술팀)
- **담당자 부재**: 현재 담당자가 휴가/퇴근 등으로 처리 불가능
- **고객 요청**: 고객이 특정 상담사를 요청

### 이관 프로세스

```
[상담사 A]
   ↓
"이 상담은 기술적 문제라 기술팀에게 넘기겠습니다"
   ↓
[이관 버튼 클릭]
   ↓
┌────────────────────────────┐
│ 이관 대상: 상담사 B (기술팀) │
│ 이관 사유: 전문가 필요       │
│ 메모: 네트워크 관련 문의     │
└────────────────────────────┘
   ↓
[상담사 B에게 전달]
   ↓
상담사 B가 알림 받음 + 처리 시작
```

### 이관 횟수 제한

```
1회 이관 → OK ✅
2회 이관 → OK ⚠️ (경고)
3회 이관 → 자동으로 관리자 에스컬레이션 🚨
```

**이유**: 너무 많이 이관되면 "공 떠넘기기"가 되므로, 3회 초과 시 자동으로 관리자가 개입

---

## 3. 에스컬레이션 (Escalation) 개념

### 언제 에스컬레이션 하나?

#### A. 자동 에스컬레이션 (시스템이 자동으로)

1. **처리 기한 초과 (SLA 위반)**
   ```
   예: 긴급 상담인데 4시간이 지나도 미처리
   → 시스템이 1시간마다 체크
   → 자동으로 관리자에게 올라감
   ```

2. **이관 횟수 초과**
   ```
   A → B → C → D (3회 이관)
   → 시스템이 감지
   → 자동으로 관리자에게 올라감
   ```

3. **고객 재문의**
   ```
   같은 고객이 같은 문제로 3번 이상 문의
   → "뭔가 제대로 해결이 안 되고 있다"
   → 자동으로 관리자에게 올라감
   ```

#### B. 수동 에스컬레이션 (상담사가 직접)

1. **복잡한 이슈**
   ```
   상담사: "이건 제가 판단할 수 없는 문제입니다"
   → [에스컬레이션 버튼] 클릭
   → 관리자에게 올림
   ```

2. **정책 결정 필요**
   ```
   예: 고객이 100만원 환불 요청
   → 상담사 권한으로는 승인 불가
   → 관리자 승인 필요
   ```

3. **VIP 고객**
   ```
   중요한 고객의 상담
   → 더 신중한 처리 필요
   → 관리자가 직접 확인
   ```

### 에스컬레이션 레벨

```
Level 0: 일반 상담사
   ↓ (에스컬레이션)
Level 1: 시니어 상담사
   ↓ (에스컬레이션)
Level 2: 팀 관리자
   ↓ (에스컬레이션)
Level 3: 부서 책임자
```

---

## 4. SLA (Service Level Agreement) - 처리 기한

### SLA란?

**"이 상담은 몇 시간 안에 처리해야 한다"는 약속**

### 우선순위별 SLA

| 우선순위 | 최대 처리 시간 | 예시                          |
|---------|--------------|------------------------------|
| 긴급 🔴  | 4시간        | 시스템 장애, VIP 고객 불만     |
| 높음 🟠  | 24시간       | 일반 불만, 긴급하지 않은 문제   |
| 보통 ⚪  | 72시간       | 일반 문의, 제품 정보 요청      |
| 낮음 ⚫  | 1주일        | 단순 문의, 피드백              |

### SLA 초과 시

```
예: 긴급 상담 등록 (14:00)
   ↓
SLA 기한: 18:00 (4시간 후)
   ↓
18:00 되었는데 아직 미처리?
   ↓
시스템이 배치 작업으로 체크 (매 1시간마다)
   ↓
자동 에스컬레이션 → 관리자에게
   ↓
관리자에게 알림: "SLA 초과 상담 발생!"
```

---

## 5. 상담 상태 (Status)

```
REGISTERED     등록됨 (상담이 막 등록됨)
   ↓
ASSIGNED       할당됨 (상담사에게 배정됨)
   ↓
IN_PROGRESS    처리중 (상담사가 처리 시작)
   ↓
   ├→ PENDING_INFO    정보 대기중 (고객 회신 대기)
   ├→ TRANSFERRED     이관됨 (다른 상담사에게)
   └→ ESCALATED       에스컬레이션됨 (관리자에게)
   ↓
RESOLVED       해결됨 (문제 해결 완료)
   ↓
CLOSED         종료됨 (상담 완전 종료)
```

---

## 6. 실제 시나리오 예시

### 시나리오 A: 정상 처리 (Happy Path)

```
1. 고객 김철수: "제품 가격이 궁금해요"
   → 상담사 A가 등록 (우선순위: 보통, SLA: 72시간)

2. 상담사 A: 가격표 확인해서 안내
   → 10분 만에 해결

3. 상태: REGISTERED → ASSIGNED → IN_PROGRESS → RESOLVED → CLOSED
   ✅ 정상 종료
```

### 시나리오 B: 이관 후 처리

```
1. 고객 이영희: "네트워크가 안 되는데요?"
   → 상담사 A가 등록 (우선순위: 높음, SLA: 24시간)

2. 상담사 A: "이건 기술적 문제네요"
   → 기술팀 상담사 B에게 이관 (1회)

3. 상담사 B: 네트워크 설정 확인 후 해결
   → 1시간 만에 해결

4. 상태: REGISTERED → ASSIGNED → IN_PROGRESS → TRANSFERRED → IN_PROGRESS → RESOLVED → CLOSED
   ✅ 정상 종료 (이관 1회)
```

### 시나리오 C: 자동 에스컬레이션

```
1. 고객 박민수: "긴급! 주문이 취소되었어요!"
   → 상담사 A가 등록 (우선순위: 긴급, SLA: 4시간)

2. 상담사 A → 상담사 B로 이관 (1회)
   이유: 주문 시스템 전문가 필요

3. 상담사 B → 상담사 C로 이관 (2회)
   이유: 해당 지역 담당자

4. 상담사 C → 상담사 D로 이관 (3회)
   이유: 결제 전문가 필요

5. 💥 시스템 감지: "이관 3회 초과!"
   → 자동으로 팀 관리자에게 에스컬레이션

6. 팀 관리자: 직접 확인하고 처리
   → 30분 만에 해결

7. 상태: ... → TRANSFERRED (3회) → ESCALATED → RESOLVED → CLOSED
   ⚠️ 에스컬레이션 발생
```

### 시나리오 D: SLA 초과로 인한 에스컬레이션

```
1. 고객 최민지: "환불 요청합니다"
   → 상담사 A가 등록 (우선순위: 높음, SLA: 24시간)
   → 등록 시간: 2025-11-07 09:00

2. 상담사 A: 업무 폭주로 처리 못함
   → 24시간 경과 (2025-11-08 09:00)

3. 💥 시스템 배치 작업 (매 1시간마다 체크)
   → "SLA 초과 발견!"
   → 자동으로 관리자에게 에스컬레이션
   → 알림: "SLA 초과 상담 #456"

4. 관리자: 즉시 확인하고 처리 지시
   → 2시간 만에 해결

5. 상태: REGISTERED → ASSIGNED → IN_PROGRESS → (24시간 경과) → ESCALATED → RESOLVED → CLOSED
   🚨 SLA 위반
```

---

## 7. 주요 테이블 구조 요약

### User (사용자/상담사/관리자)
```
id, username, name, email, role, department
역할: COUNSELOR, SENIOR_COUNSELOR, MANAGER, ADMIN
```

### Counseling (상담)
```
id, customer_name, contact, counseling_type
status, priority
counselor_id (현재 담당자)
escalation_level, transfer_count
sla_due_date (처리 기한)
content, resolution
```

### CounselingHistory (상담 이력)
```
id, counseling_id
action_type (CREATED, TRANSFERRED, ESCALATED, etc.)
from_user_id, to_user_id
comment, reason
performed_by, performed_at
→ "누가, 언제, 무엇을, 왜 했는지" 모든 이력 추적
```

### Notification (알림)
```
id, user_id, counseling_id
type (ASSIGNED, TRANSFERRED, ESCALATED, OVERDUE)
title, message
is_read, read_at
→ 실시간으로 상담사/관리자에게 알림
```

---

## 8. 화면 구성 요약

### 상담사 화면
- **상담 목록**: 내가 담당한 상담 보기, 검색, 필터
- **상담 등록**: 새 상담 등록
- **상담 상세**: 상담 내용 보기, 메모 추가, 상태 변경
- **이관하기**: 다른 상담사에게 이관
- **에스컬레이션**: 관리자에게 올리기

### 관리자 화면
- **대시보드**: 에스컬레이션된 상담, SLA 초과 위험, 팀별 현황
- **긴급 상담 목록**: 즉시 처리 필요한 상담
- **통계**: 팀별/상담사별 처리 현황

---

## 9. 핵심 가치

### 왜 이관 기능이 필요한가?
✅ 전문가에게 빠르게 연결하여 **해결 시간 단축**
✅ 업무를 공평하게 분산하여 **업무 효율성 증가**
✅ 담당자 부재 시에도 **서비스 연속성 유지**

### 왜 에스컬레이션이 필요한가?
✅ 복잡한 문제를 **더 높은 권한**으로 처리
✅ 미처리 상담을 **시스템이 자동으로 감지**하여 방치 방지
✅ VIP 고객이나 중요한 이슈에 **관리자의 직접 개입**

### 왜 SLA가 필요한가?
✅ 고객에게 **명확한 처리 기한 약속**
✅ 상담사에게 **명확한 업무 우선순위 제공**
✅ 관리자에게 **객관적인 성과 측정 지표 제공**

---

## 10. 구현 우선순위

### 1순위 (필수)
- ✅ User 및 Role 관리
- ✅ Counseling 확장 (우선순위, SLA, 상태)
- ✅ 상담 등록/조회/수정
- ✅ 이관 기능
- ✅ CounselingHistory (이력 추적)

### 2순위 (중요)
- ✅ 수동 에스컬레이션
- ✅ SLA 자동 계산
- ✅ 알림 기능
- ✅ 관리자 대시보드

### 3순위 (고급)
- ⭐ 자동 에스컬레이션 (배치 작업)
- ⭐ 실시간 알림 (WebSocket)
- ⭐ 통계 및 리포트
- ⭐ 자동 할당 알고리즘

---

이 설계로 **체계적인 상담 관리 시스템**을 구축할 수 있습니다!

질문이나 수정이 필요한 부분이 있으신가요?
